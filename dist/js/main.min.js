define("util",[],function(){function e(e,t){return"undefined"!=typeof window.getComputedStyle?(computedStyle=window.getComputedStyle(e,null),computedStyle[t]):"undefined"!=typeof e.currentStyle?e.currentStyle[t]:void 0}var t=function(e,n,i){return(t=e.addEventListener?function(e,t,n){e.addEventListener(t,n,!1)}:e.attachEvent?function(e,t,n){e.attachEvent("on"+t,n)}:function(e,t,n){e["on"+t]=n})(e,n,i)},n=function(e,t,n){if("undefined"!=typeof e.removeEventListener)e.removeEventListener(t,n,!1);else if(e.events)for(var i in e.events[t])e.events[t][i]==n&&delete e.events[t][i]},i=function(){var e=document.documentElement.scrollTop||document.body.scrollTop,t=document.documentElement.scrollLeft||document.body.scrollLeft;return{top:e,left:t}},a=function(){var e=window.innerWidth,t=window.innerHeight;return"number"!=typeof e&&("CSS1Compat"==document.compatMode?(e=document.documentElement.clientWidth,t=document.documentElement.clientHeight):(e=document.body.clientWidth,pageHight=document.body.clientHeight)),{width:e,height:t}},o=function(e,t,n){t=parseInt(t.replace("px","")),n=parseInt(n.replace("px",""));var o=(a().height-n)/2+i().top,r=(a().width-t)/2+i().left;e.style.top=o+"px",e.style.left=r+"px"},r=function(e,t){var n=t.parentNode;n.lastChild==t?n.appendChild(e):n.insertBefore(e,t.nextSibling)};return{addHandler:t,removeHandler:n,getViewport:a,scroll:i,center:o,insertAfter:r,getStyle:e}}),define("calendar",["util"],function(e){function t(e){this.date=new Date,this.year=this.date.getFullYear(),this.month=this.date.getMonth()+1,this.day=this.date.getDate(),this.th=["日","一","二","三","四","五","六"],this.tb=[],this.selMonth,this.selYear,this.selDay,this.getDate=e.showDate,this.callback=e.callback}var n=function(e){var n=new t(e);n.display()};return t.prototype={display:function(){var t=document.querySelector(".calendar");this.genDom(t);var n=document.querySelector(".left"),i=document.querySelector(".right");this.selMonth=this.month,this.selYear=this.year,this.selDay=this.day,this.getSelDate(),this.getEcho(),this.tbodyData(),this.genTable();var a=this;e.addHandler(n,"click",function(){return a.selYear==a.year&&a.selMonth==a.month?void(this.style.borderRight="7px solid #CCC"):void a.prevDay()}),e.addHandler(i,"click",function(){n.style.borderRight="7px solid #FFF",a.nextDay()})},genDom:function(e){e.innerHTML='<form><span class="left"></span><div class="echo">2016年05月</div><span class="right"></span></form><table class="tb"></table>'},getSelDate:function(){parseInt(this.selMonth)<=9?parseInt(this.selDay)<=9?this.getDate.value=this.selYear+"-0"+this.selMonth+"-0"+this.selDay:this.getDate.value=this.selYear+"-0"+this.selMonth+"-"+this.selDay:this.getDate.value=this.selYear+"-"+this.selMonth+"-"+this.selDay,this.callback()},getEcho:function(){var e=document.querySelector(".echo");parseInt(this.selMonth)<=9?e.innerHTML=this.selYear+"年0"+this.selMonth+"月":e.innerHTML=this.selYear+"年"+this.selMonth+"月"},prevDay:function(){var e=document.querySelector(".tb");1==this.selMonth?(this.selMonth=12,this.selYear=this.selYear-1):(this.selMonth=this.selMonth-1,this.selYear=this.selYear),this.getEcho(),this.tbodyData(),e.removeChild(document.getElementsByTagName("thead")[0]),e.removeChild(document.getElementsByTagName("tbody")[0]),this.genTable()},nextDay:function(){var e=document.querySelector(".tb");12==parseInt(this.selMonth)?(this.selMonth=1,this.selYear=parseInt(this.selYear)+1):(this.selMonth=parseInt(this.selMonth)+1,this.selYear=this.selYear),this.getEcho(),this.tbodyData(),e.removeChild(document.getElementsByTagName("thead")[0]),e.removeChild(document.getElementsByTagName("tbody")[0]),this.genTable()},tbodyData:function(){for(var e=new Date(this.selYear,this.selMonth),t=e.getUTCDate(),n=new Date(this.selYear,this.selMonth-1,1).getDay(),i=0;6>i;i++)this.tb[i]=[];this.tb[0][n]=1;for(var i=(new Date(this.selYear,this.selMonth-1).getUTCDate(),0);7>i;i++)n>i?this.tb[0][i]="":i>n&&(this.tb[0][i]=this.tb[0][i-1]+1);for(var i=1;6>i;i++)for(var a=0;7>a;a++)if(0==a?this.tb[i][a]=this.tb[i-1][6]+1:this.tb[i][a]=this.tb[i][a-1]+1,this.tb[i][a]>=t)return},genTable:function(){this.createThead(),this.createTbody(this)},createThead:function(){for(var e=document.querySelector(".tb"),t=document.createElement("thead"),n=document.createElement("tr"),i=0;i<this.th.length;i++){var a=document.createElement("td"),o=document.createTextNode(this.th[i]);a.appendChild(o),n.appendChild(a)}t.appendChild(n),e.appendChild(t)},createTbody:function(t){function n(){o.forEach(function(e){e.style.backgroundColor="#fff",e.style.color="#333"})}for(var i=document.querySelector(".tb"),a=document.querySelector(".calendar"),o=[],r=document.createElement("tbody"),l=0;l<this.tb.length;l++){for(var s=document.createElement("tr"),d=0;d<this.tb[l].length;d++){var c=document.createElement("td"),h=document.createTextNode(this.tb[l][d]);c.appendChild(h),0==l&&""==this.tb[l][d]?c.style.color="#fff":l>3&&this.tb[l][d]<20?c.style.color="#fff":t.selYear==t.year&&t.selMonth==t.month&&parseInt(this.tb[l][d])<t.day?(c.style.backgroundColor="#fff",c.style.color="#ccc"):o.push(c),s.appendChild(c)}r.appendChild(s)}for(var l=0;l<o.length;l++)e.addHandler(o[l],"mouseover",function(){this.style.backgroundColor="#f96",this.style.color="#fff"}),e.addHandler(o[l],"mouseout",function(){n()}),e.addHandler(o[l],"click",function(){t.selDay=this.innerHTML,a.style.display="none",t.getSelDate()});i.appendChild(r)}},{calendarOut:n}}),define("layer",["util"],function(e){function t(e){this.head=e.head,this.content=e.content,this.callback=e.callback}var n=function(e){var n=new t(e);n.init()};return t.prototype={init:function(){var e=document.querySelector(".draken"),t=(document.querySelector("body"),'<div class="screen"></div><div class="layer"><h2>'+this.head+"<span>×</span></h2><div>"+this.content+'</div><div class="btn"><button>确定</button><button>取消</button></div></div>');e.innerHTML=t,this.drag(),this.pop(),this.close()},drag:function(){var t=document.querySelector(".layer");e.addHandler(t,"mousedown",function(t){function n(t){var n=t.clientX-a,i=t.clientY-o;0>n?n=0:n>e.getViewport().width-r.offsetWidth&&(n=e.getViewport().width-r.offsetWidth),0>i?i=0:i>e.getViewport().height-r.offsetHeight&&(i=e.getViewport().height-r.offsetHeight),r.style.left=n+"px",r.style.top=i+"px"}function i(){e.removeHandler(document,"mousemove",n),e.removeHandler(document,"mouseup",i)}var t=t?t:window.event,a=t.clientX-this.offsetLeft,o=t.clientY-this.offsetTop;"H2"==t.target.tagName&&(e.addHandler(document,"mousemove",n),e.addHandler(document,"mouseup",i));var r=this})},pop:function(){var t=document.querySelector(".layer");t.style.display="block",width=e.getStyle(t,"width"),height=e.getStyle(t,"height"),e.center(t,width,height);var n=document.querySelector(".screen");n.style.display="block",n.style.height=e.getViewport().height+e.scroll().top+"px",window.onresize=function(){e.center(t,width,height),n.style.height=e.getViewport().height+e.scroll().top+"px"},window.onscroll=function(){e.center(t,width,height),n.style.height=e.getViewport().height+e.scroll().top+"px"}},close:function(){var t=document.querySelector(".layer"),n=document.querySelector(".screen"),i=t.querySelectorAll("button"),a=i[0],o=i[1],r=t.querySelector("h2 span");e.addHandler(n,"click",function(){t.style.display="none",n.style.display="none"});var l=this;e.addHandler(a,"click",function(){t.style.display="none",n.style.display="none",l.callback()}),e.addHandler(o,"click",function(){t.style.display="none",n.style.display="none"}),e.addHandler(r,"click",function(){t.style.display="none",n.style.display="none"})}},{layerOut:n}}),define("editPage",["util","calendar","layer"],function(e,t,n){function i(){1==arguments.length?(this.num=arguments[0].num,this.head=arguments[0].head,this.storage=arguments[0].storage,this.flag=!0):(this.flag=!1,this.storage=[],this.head="我的问卷"),this.deadline,this.state="未保存"}return i.prototype={refresh:function(){var e=document.getElementById("content"),t="";t='<div id="edit-page"><h3 class="head" contenteditable="true">'+this.head+'</h3><div class="body"><div class="problem"></div><div class="add_problem"><div class="form"><button>单选</button><button>多选</button><button>文本题</button></div><div class="add"><span>+</span> 添加问题</div></div></div><div class="foot"><div class="deadline">问卷截止日期 <input type="text" name="deadline"><div class="calendar"></div></div><button>发布问卷</button><button>保存问卷</button></div></div>',e.innerHTML=t,this.flag&&this.render(),this.editEvent(),this.ItemEvent(),this.changeEvent(),this.calendar(),this.save(),this.release()},editEvent:function(){var t=document.querySelector(".head"),n=document.querySelector(".add"),i=document.querySelector(".form"),a=i.querySelectorAll("button"),o=a[0],r=a[1],l=a[2];this.head=t.innerHTML;var s=this;e.addHandler(t,"click",function(){this.style.border="2px solid #9cf"}),e.addHandler(t,"blur",function(){this.style.border="none",t.innerHTML!=s.head&&(s.head=t.innerHTML)}),e.addHandler(n,"click",function(){i.style.display="block"}),e.addHandler(o,"click",function(){i.style.display="none";var e={type:1,title:"单选题",item:["选项1","选项2"]};return 10==s.storage.length?void alert("最多只能添加10个问题"):(s.storage.push(e),void s.render())}),e.addHandler(r,"click",function(){i.style.display="none";var e={type:2,title:"多选题",item:["选项1","选项2","选项3","选项4"]};return 10==s.storage.length?void alert("最多只能添加10个问题"):(s.storage.push(e),void s.render())}),e.addHandler(l,"click",function(){i.style.display="none";var e={type:3,title:"文本题"};return 10==s.storage.length?void alert("最多只能添加10个问题"):(s.storage.push(e),void s.render())})},ItemEvent:function(){var t=document.querySelector(".problem"),i=this;e.addHandler(t,"click",function(e){var e=e?e:window.event;if("复用"==e.target.innerHTML){if(10==i.storage.length)return void alert("最多只能添加10个问题");var t=parseInt(e.target.parentNode.querySelector(".num").innerHTML.substring(1));i.copyEvent(t-1)}if("删除"==e.target.innerHTML&&n.layerOut({head:"提示",content:"是否要删除该问题",callback:function(){var t=parseInt(e.target.parentNode.querySelector(".num").innerHTML.substring(1));i.delEvent(t-1)}}),"上移"==e.target.innerHTML){var t=parseInt(e.target.parentNode.querySelector(".num").innerHTML.substring(1));i.upEvent(t-1)}if("下移"==e.target.innerHTML){var t=parseInt(e.target.parentNode.querySelector(".num").innerHTML.substring(1));i.downEvent(t-1)}if("+"==e.target.innerHTML){var t=parseInt(e.target.parentNode.querySelector(".num").innerHTML.substring(1));i.addItem(t-1)}if("×"==e.target.innerHTML){var t=parseInt(e.target.parentNode.querySelector(".num").innerHTML.substring(1)),a=e.target.previousElementSibling.innerHTML,o=i.storage[t-1].item.indexOf(a);i.delItem(t-1,o)}})},addItem:function(e){var t=this.storage[e].item.length;this.storage[e].item.push("选项"+(t+1)),this.render()},delItem:function(e,t){this.storage[e].item.splice(t,1),this.render()},copyEvent:function(e){this.storage.splice(e+1,0,this.storage[e]),this.render()},delEvent:function(e){this.storage.splice(e,1),this.render()},upEvent:function(e){var t={};t=this.storage[e],this.storage[e]=this.storage[e-1],this.storage[e-1]=t,this.render()},downEvent:function(e){var t={};t=this.storage[e],this.storage[e]=this.storage[e+1],this.storage[e+1]=t,this.render()},changeEvent:function(){var t=document.querySelector(".problem"),n=this;e.addHandler(t,"click",function(t){var t=t?t:window.event;if("title"==t.target.className&&(t.target.style.border="2px solid #9cf",e.addHandler(t.target,"keyup",function(){"<br>"==t.target.innerHTML.trim()&&(t.target.innerHTML="")}),e.addHandler(t.target,"blur",function(){t.target.style.border="none";var e=parseInt(t.target.parentNode.querySelector(".num").innerHTML.substring(1));n.changeTitle(t.target,e-1)})),"item"==t.target.className){t.target.style.border="2px solid #9cf",e.addHandler(t.target,"keyup",function(){"<br>"==t.target.innerHTML.trim()&&(t.target.innerHTML="")});var i=parseInt(t.target.parentNode.querySelector(".num").innerHTML.substring(1)),a=t.target.innerHTML,o=n.storage[i-1].item.indexOf(a);!function(){e.addHandler(t.target,"blur",function(){t.target.style.border="none",n.changeItem(t.target,i-1,o)})}(i,o)}})},changeTitle:function(e,t){e.innerHTML!=this.storage[t].title&&(this.storage[t].title=e.innerHTML,this.render())},changeItem:function(e,t,n){e.innerHTML!=this.storage[t].item[n]&&(this.storage[t].item[n]=e.innerHTML,this.render())},render:function(){var t=document.querySelector(".problem");t.innerHTML="";for(var n=0;n<this.storage.length;n++){var i=document.createElement("div");i.className="box";var a=document.createElement("span");a.className="num",a.innerHTML="Q"+(n+1),i.appendChild(a);var o=document.createElement("div");o.className="title",o.contentEditable="true",o.innerHTML=this.storage[n].title,i.appendChild(o);var r=document.createElement("br");if(i.appendChild(r),void 0!=this.storage[n].item)for(var l=0;l<this.storage[n].item.length;l++){var s=document.createElement("input");1==this.storage[n].type&&(s.type="radio"),2==this.storage[n].type&&(s.type="checkbox"),s.name="item"+n,i.appendChild(s);var d=document.createElement("div");d.className="item",d.contentEditable="true",d.innerHTML=this.storage[n].item[l],i.appendChild(d);var c=document.createElement("a");c.innerHTML="×",i.appendChild(c);var r=document.createElement("br");i.appendChild(r)}else i.innerHTML=i.innerHTML+'<textarea rows="4" cols="70"></textarea><br>';3!=this.storage[n].type&&(i.innerHTML=i.innerHTML+"<p>+</p>"),i.innerHTML=i.innerHTML+"<span>删除</span><span>复用</span><span>下移</span><span>上移</span>";var h=this;!function(t){var n=parseInt(i.querySelector(".num").innerHTML.substring(1)),a=i.querySelectorAll("span"),o=a[1],r=a[2],l=a[3],s=a[4];e.addHandler(i,"mouseover",function(){this.style.backgroundColor="#fc9",void 0!=this.querySelector("p")&&(this.querySelector("p").style.display="block"),1==h.storage.length?(o.style.display="inline",r.style.display="inline"):1==n?(o.style.display="inline",r.style.display="inline",l.style.display="inline"):n==h.storage.length?(o.style.display="inline",r.style.display="inline",s.style.display="inline"):(o.style.display="inline",r.style.display="inline",l.style.display="inline",s.style.display="inline");for(var e=this.querySelectorAll("a"),t=0;t<e.length;t++)e[t].style.display="inline"}),e.addHandler(i,"mouseout",function(){this.style.backgroundColor="#fff",void 0!=this.querySelector("p")&&(this.querySelector("p").style.display="none"),o.style.display="none",r.style.display="none",l.style.display="none",s.style.display="none";for(var e=this.querySelectorAll("a"),t=0;t<e.length;t++)e[t].style.display="none"})}(n),t.appendChild(i)}},calendar:function(){var n=document.getElementsByName("deadline")[0],i=document.querySelector(".calendar"),a=this;t.calendarOut({showDate:n,callback:function(){a.deadline=n.value}});e.addHandler(n,"click",function(){"block"==i.style.display?i.style.display="none":i.style.display="block"})},save:function(){var t=document.querySelector(".foot"),i=t.querySelectorAll("button")[1],a=this;e.addHandler(i,"click",function(){return a.storage.length<1?void alert("请至少给问卷添加一个问题"):void n.layerOut({head:"提示",content:"是否保存问卷?",callback:function(){n.layerOut({head:"提示",content:"问卷保存成功！",callback:function(){a.state="未发布",a.flag?a.changeStore():a.store()}})}})})},release:function(){var t=document.querySelector(".foot"),i=t.querySelectorAll("button")[0],a=this;e.addHandler(i,"click",function(){return a.storage.length<1?void alert("请至少给问卷添加一个问题"):void n.layerOut({head:"提示",content:"是否发布问卷?",callback:function(){n.layerOut({head:"提示",content:"发布成功！",callback:function(){"未保存"==a.state?(a.state="发布中",a.flag?a.changeStore():a.store()):(a.state="发布中",a.flag?(qnState=JSON.parse(window.localStorage.getItem("qnState")),qnState.splice(a.num,1,a.state),window.localStorage.setItem("qnState",JSON.stringify(qnState))):(qnState=JSON.parse(window.localStorage.getItem("qnState")),qnState.pop(),qnState.push(a.state),window.localStorage.setItem("qnState",JSON.stringify(qnState)))),window.location.hash="#listPage"}})}})})},store:function(){if(window.localStorage)if(null==window.localStorage.getItem("qnContent")){var e=[];e[0]=this.storage,window.localStorage.setItem("qnContent",JSON.stringify(e));var t=[];t[0]=this.head,window.localStorage.setItem("qnTitle",JSON.stringify(t));var n=[];n[0]=this.deadline,window.localStorage.setItem("qnDeadline",JSON.stringify(n));var i=[];i[0]=this.state,window.localStorage.setItem("qnState",JSON.stringify(i))}else e=JSON.parse(window.localStorage.getItem("qnContent")),e.push(this.storage),window.localStorage.setItem("qnContent",JSON.stringify(e)),t=JSON.parse(window.localStorage.getItem("qnTitle")),t.push(this.head),window.localStorage.setItem("qnTitle",JSON.stringify(t)),n=JSON.parse(window.localStorage.getItem("qnDeadline")),n.push(this.deadline),window.localStorage.setItem("qnDeadline",JSON.stringify(n)),i=JSON.parse(window.localStorage.getItem("qnState")),i.push(this.state),window.localStorage.setItem("qnState",JSON.stringify(i));else alert("This brower does NOT support localStorage.Please update your brower!")},changeStore:function(){window.localStorage?(qnContent=JSON.parse(window.localStorage.getItem("qnContent")),qnContent.splice(this.num,1,this.storage),window.localStorage.setItem("qnContent",JSON.stringify(qnContent)),qnTitle=JSON.parse(window.localStorage.getItem("qnTitle")),qnTitle.splice(this.num,1,this.head),window.localStorage.setItem("qnTitle",JSON.stringify(qnTitle)),qnDeadline=JSON.parse(window.localStorage.getItem("qnDeadline")),qnDeadline.splice(this.num,1,this.deadline),window.localStorage.setItem("qnDeadline",JSON.stringify(qnDeadline)),qnState=JSON.parse(window.localStorage.getItem("qnState")),qnState.splice(this.num,1,this.state),window.localStorage.setItem("qnState",JSON.stringify(qnState))):alert("This brower does NOT support localStorage.Please update your brower!")}},{Edit:i}}),define("newBuilt",["util","editPage"],function(e,t){var n=function(){i(),a()},i=function(){var e=document.getElementById("content"),t="";t='<div id="new-built"><button><span>+ </span>新建问卷</button></div>',e.innerHTML=t},a=function(){builtBtn=document.getElementsByTagName("button")[0],e.addHandler(builtBtn,"click",function(){window.location.hash="#editPage";var e=new t.Edit;e.refresh()})};return{new_built:n}}),define("qnPage",["util","layer"],function(e,t){function n(e){this.head=e.head,this.state=e.state,this.probList=e.probList,this.flag=!1}var i=function(e){var t=new n(e);t.refresh()};return n.prototype={refresh:function(){var e=document.getElementById("content");e.innerHTML='<div id="qn-page"><h2 class="head">'+this.head+'</h2><p>标有<span> * </span>的题目为必做题</p><div class="body"><div class="problem"></div></div><div class="foot"><button>提交</button></div></div>',this.genProblem(),this.submit()},genProblem:function(){var e=document.querySelector(".problem");e.innerHTML="";for(var t=0;t<this.probList.length;t++){var n=document.createElement("div");n.className="box";var i=document.createElement("span");i.innerHTML="Q"+(t+1),n.appendChild(i);var a=document.createElement("span");a.innerHTML=this.probList[t].title,3!=this.probList[t].type&&(a.innerHTML=a.innerHTML+"<span> *</span>"),n.appendChild(a);var o=document.createElement("br");if(n.appendChild(o),void 0!=this.probList[t].item)for(var r=0;r<this.probList[t].item.length;r++){var l=document.createElement("input");1==this.probList[t].type&&(l.type="radio"),2==this.probList[t].type&&(l.type="checkbox"),l.name="item"+t,n.appendChild(l);var s=document.createElement("span");s.className="item",s.innerHTML=this.probList[t].item[r],n.appendChild(s);var o=document.createElement("br");n.appendChild(o)}else n.innerHTML=n.innerHTML+'<textarea rows="4" cols="70"></textarea><br>';e.appendChild(n)}},submit:function(){var n=document.querySelector(".foot button"),i=this;e.addHandler(n,"click",function(){"发布中"!=i.state?t.layerOut({head:"提示",content:"此问卷未发布或已结束，无法提交！",callback:function(){}}):(i.verify(),i.flag?t.layerOut({head:"提示",content:"请完整填写问卷！",callback:function(){}}):t.layerOut({head:"提示",content:"提交成功！",callback:function(){window.location.hash="#listPage"}}))})},verify:function(){for(var e=document.querySelectorAll(".body .problem .box"),t=[],n=0;n<e.length;n++)if(0!=e[n].querySelectorAll("input").length){for(var i=e[n].querySelectorAll("input"),a=0,o=0;o<i.length;o++)1==i[o].checked&&a++;t.push(a)}-1!=t.indexOf(0)?this.flag=!0:this.flag=!1}},{qnPage:i}}),define("resultPage",["util","layer"],function(e,t){function n(e){this.problems=e.probList,this.head=e.head}function i(e,t){var n;if(2==e.type){var i=echarts.init(t);n={title:{text:e.title,subtext:"数据随机生成",left:"left"},tooltip:{show:!0},xAxis:[{type:"category",data:e.item}],yAxis:[{type:"value"}],series:[{name:"人数",type:"bar",data:function(e){for(var t=[],n=0;e>n;n++)t.push(parseInt(91*Math.random()+10));return t}(e.item.length)}]},i.setOption(n)}else if(1==e.type){var i=echarts.init(t);n={title:{text:e.title,left:"left"},tooltip:{trigger:"item",formatter:"{a} <br/>{b} : {c} ({d}%)"},series:[{name:"访问来源",type:"pie",radius:"55%",center:["50%","50%"],data:function(t){for(var n=[],i=0;t>i;i++)n.push({value:parseInt(71*Math.random()+10),name:e.item[i]});return n}(e.item.length).sort(function(e,t){return e.value-t.value})}]},i.setOption(n)}else if(3==e.type){var i=echarts.init(t);n={title:{text:e.title,left:"left"},tooltip:{trigger:"item",formatter:"{a} <br/>{b}: {c} ({d}%)"},series:[{name:"文本填写",type:"pie",radius:["50%","70%"],avoidLabelOverlap:!1,label:{normal:{show:!1,position:"center"},emphasis:{show:!0,textStyle:{fontSize:"16",fontWeight:"bold"}}},labelLine:{normal:{show:!1}},data:[{value:parseInt(71*Math.random()+10),name:"有效填写"},{value:parseInt(71*Math.random()+10),name:"无效填写"}]}]},i.setOption(n)}}var a=function(e){var t=new n(e);t.refersh()};return n.prototype={refersh:function(){var e=document.getElementById("content");e.innerHTML='<div id="result-page"><div class="head"><span>＜ 返回</span><h2>'+this.head+'</h2><p>此统计分析只包含完整回收的数据</p></div><div class="body"></div><div class="foot"><button>＜ 返回</button></div></div>',this.backToList(),this.problemDom();for(var t=document.querySelectorAll(".data"),n=this,a=0;a<t.length;a++)!function(){i(n.problems[a],t[a])}(a)},problemDom:function(){var e=document.querySelector(".body");e.innerHTML="";for(var t=0;t<this.problems.length;t++){var n=document.createElement("div");n.className="box";var i=document.createElement("div");i.className="data",n.appendChild(i),e.appendChild(n)}},backToList:function(){var t=document.querySelector(".head span"),n=document.querySelector(".foot button");e.addHandler(t,"click",function(){window.location.hash="listPage"}),e.addHandler(n,"click",function(){window.location.hash="listPage"})}},{result:a}}),define("listPage",["util","layer","editPage","qnPage","resultPage"],function(e,t,n,i,a){function o(){this.qnTitle=[],this.qnDeadline=[],this.qnState=[],this.qnContent=[]}return o.prototype={refresh:function(){if(window.localStorage)if(null==window.localStorage.getItem("qnContent")||0==JSON.parse(window.localStorage.getItem("qnContent")).length)window.location.hash="#newBuilt";else{var e=document.getElementById("content"),t="";t='<div id="list-page"><div class="head"><div class="titText">标题</div><div>时间</div><div>状态</div><div class="opeText">操作<button>+ 新建问卷</button></div></div><div class="body"></div><div class="foot"><input type="radio"><span>全选</span><button>删除</button></div></div>',e.innerHTML=t,this.newBuilt(),this.render(),this.listBtnEvent(),this.deleteAll()}else alert("This brower does NOT support localStorage.Please update your brower!")},render:function(){var e=document.querySelector(".body");e.innerHTML="";var t=new Date,n=t.getFullYear(),i=t.getMonth()+1,a=t.getDate();this.qnTitle=JSON.parse(window.localStorage.getItem("qnTitle")),this.qnDeadline=JSON.parse(window.localStorage.getItem("qnDeadline")),this.qnState=JSON.parse(window.localStorage.getItem("qnState")),this.qnContent=JSON.parse(window.localStorage.getItem("qnContent"));for(var o=0;o<this.qnTitle.length;o++){var r=this.qnDeadline[o].split("-");parseInt(r[0])<parseInt(n)?this.qnState[o]="已结束":parseInt(r[0])==parseInt(n)&&(parseInt(r[1])<parseInt(i)?this.qnState[o]="已结束":parseInt(r[1])==parseInt(i)&&parseInt(r[2])<parseInt(a)&&(this.qnState[o]="已结束"));var l=document.createElement("div");l.className="qn-list",l.innerHTML='<input type="checkbox"><div class="title">'+this.qnTitle[o]+"</div><div>"+this.qnDeadline[o]+"</div><div>"+this.qnState[o]+'</div><div class="operation"><button>编辑</button><button>删除</button><button>填写问卷</button><button>查看数据</button></div>',e.appendChild(l)}},newBuilt:function(){var t=document.querySelector(".head button");e.addHandler(t,"click",function(){window.location.hash="#editPage";var e=new n.Edit;e.refresh()})},listBtnEvent:function(){for(var t=document.querySelectorAll(".qn-list"),n=this,i=0;i<t.length;i++)!function(i){var a=t[i].querySelectorAll(".operation button"),o=a[0],r=a[1],l=a[2],s=a[3];e.addHandler(o,"click",function(){n.editBtnEvent(i)}),e.addHandler(r,"click",function(){n.delBtnEvent(i)}),e.addHandler(l,"click",function(){n.fillBtnEvent(i)}),e.addHandler(s,"click",function(){n.catResultEvent(i)})}(i)},editBtnEvent:function(e){if("未发布"==this.qnState[e]){window.location.hash="#editPage";var i=JSON.parse(window.localStorage.getItem("qnContent"))[e],a=JSON.parse(window.localStorage.getItem("qnTitle"))[e],o=new n.Edit({num:e,storage:i,head:a});o.refresh()}else t.layerOut({head:"提示",content:"问卷发布中或已结束，无法编辑",callback:function(){}})},delBtnEvent:function(e){var n=this;t.layerOut({head:"提示",content:"确定要删除该问卷吗？",callback:function(){n.deleteOne(e),n.refresh()}})},fillBtnEvent:function(e){var t=JSON.parse(window.localStorage.getItem("qnContent"))[e],n=JSON.parse(window.localStorage.getItem("qnTitle"))[e],a=JSON.parse(window.localStorage.getItem("qnState"))[e];window.location.hash="#qnFill",i.qnPage({probList:t,head:n,state:a})},catResultEvent:function(e){if("未发布"==this.qnState[e])t.layerOut({head:"提示",content:"问卷还未发布，无法查看数据！",callback:function(){}});else{var n=JSON.parse(window.localStorage.getItem("qnContent"))[e],i=JSON.parse(window.localStorage.getItem("qnTitle"))[e];window.location.hash="#resultPage",a.result({probList:n,head:i})}},deleteAll:function(){var t=document.querySelectorAll(".qn-list input"),n=document.querySelector(".foot input"),i=document.querySelector(".foot button"),a=this;e.addHandler(n,"click",function(){if(1==n.checked)for(var o=0;o<t.length;o++)t[o].checked=!0,e.addHandler(i,"click",function(){window.localStorage.removeItem("qnContent"),window.localStorage.removeItem("qnTitle"),window.localStorage.removeItem("qnDeadline"),window.localStorage.removeItem("qnState"),a.refresh()})}),e.addHandler(i,"click",function(){for(var e=0,n=0;n<t.length;n++)1==t[n].checked&&(a.deleteOne(n-e),a.refresh(),e++)})},deleteOne:function(e){var t=JSON.parse(window.localStorage.getItem("qnContent"));t.splice(e,1),window.localStorage.setItem("qnContent",JSON.stringify(t));var n=JSON.parse(window.localStorage.getItem("qnTitle"));n.splice(e,1),window.localStorage.setItem("qnTitle",JSON.stringify(n));var i=JSON.parse(window.localStorage.getItem("qnDeadline"));i.splice(e,1),window.localStorage.setItem("qnDeadline",JSON.stringify(i));var a=JSON.parse(window.localStorage.getItem("qnState"));a.splice(e,1),window.localStorage.setItem("qnState",JSON.stringify(a))}},{List:o}}),require(["newBuilt","listPage","editPage"],function(e,t,n){window.location.hash="#listPage";var i=new t.List;i.refresh(),window.onhashchange=function(n){if("#newBuilt"==window.location.hash)e.new_built();else if("#listPage"==window.location.hash){var i=new t.List;i.refresh()}}});